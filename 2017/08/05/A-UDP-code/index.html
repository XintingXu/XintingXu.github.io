<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="个人博客"><meta name="keywords" content="博客, 开发, 计算机, 编程"><title>一个简单的UDP测试程序 | 雁家</title><link rel="stylesheet" type="text/css" href="//fonts.css.network/css?family=Source+Code+Pro"><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.1"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.1"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">一个简单的UDP测试程序</h1><a id="logo" href="/.">雁家</a><p class="description">徐欣廷的自留地</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="Arama"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">一个简单的UDP测试程序</h1><Post>by 徐欣廷</Post><div class="post-meta"><a href="/2017/08/05/A-UDP-code/#comments" class="comment-count"><i id="changyan_count_unit" data-xid="2017/08/05/A-UDP-code/"></i>留言,<i id="changyan_parti_unit" data-xid="2017/08/05/A-UDP-code/"></i>参与</a><p><span class="date">Aug 05, 2017</span><span><a href="/categories/blog/" class="category">Blog</a></span><span><i id="busuanzi_container_page_pv"><i id="busuanzi_value_page_pv"></i><i>点击</i></i></span></p></div><div class="post-content"><h1 id="一个简单的UDP测试程序"><a href="#一个简单的UDP测试程序" class="headerlink" title="一个简单的UDP测试程序"></a>一个简单的UDP测试程序</h1><h2 id="功能介绍"><a href="#功能介绍" class="headerlink" title="功能介绍"></a>功能介绍</h2><p>这是一个简单的UDP测试程序，用于UDP数据包的发送、接收测试。</p>
<h4 id="它能干什么？"><a href="#它能干什么？" class="headerlink" title="它能干什么？"></a>它能干什么？</h4><p>它集成了客户端和服务端两个部分，可以通过命令行的启动参数进行状态转换。</p>
<p>它可以按照一定的时间进行UDP数据包的发送，也可以设定发送的UDP数据包的负载长度，当然也可以设定每一轮发送数据包的数量。此外，服务进程监听的端口号及客户进程发送时的目标端口也是可以设定的。</p>
<p>不过，需要确定的是，发送时的IP地址和端口号必须是可连通的。比如，发送端和接收端的设备应该处于同一个子网中，如果发生跨子网的情况，则无法成功进行数据传送。</p>
<h2 id="代码展示"><a href="#代码展示" class="headerlink" title="代码展示"></a>代码展示</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#incnclude <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;getopt.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdbool.h&gt;</span></span></div><div class="line"><span class="meta">#incle <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;netinet/in.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;arpa/inet.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fcntl.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/time.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></div><div class="line"><span class="keyword">char</span> *l_opt_arg;</div><div class="line"><span class="keyword">char</span>* <span class="keyword">const</span> short_options = <span class="string">"c:l:i:srhp:a:y:"</span>;</div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">struct option</span></div><div class="line"><span class="comment">&#123;</span></div><div class="line"><span class="comment">  const char *name;</span></div><div class="line"><span class="comment">  int has_arg;</span></div><div class="line"><span class="comment">  int *flag;</span></div><div class="line"><span class="comment">  int val;</span></div><div class="line"><span class="comment">&#125;;</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">option</span> <span class="title">long_options</span>[] = &#123;</span></div><div class="line">&#123; <span class="string">"count"</span>, <span class="number">1</span>, <span class="literal">NULL</span>, <span class="string">'c'</span> &#125;,</div><div class="line">&#123; <span class="string">"length"</span>, <span class="number">1</span>, <span class="literal">NULL</span>, <span class="string">'l'</span> &#125;,</div><div class="line">&#123; <span class="string">"interval"</span>, <span class="number">1</span>, <span class="literal">NULL</span>, <span class="string">'i'</span> &#125;,</div><div class="line">&#123; <span class="string">"port"</span>, <span class="number">1</span>, <span class="literal">NULL</span>, <span class="string">'p'</span> &#125;,</div><div class="line">&#123; <span class="string">"ip"</span>, <span class="number">1</span>, <span class="literal">NULL</span>, <span class="string">'a'</span> &#125;,</div><div class="line">&#123; <span class="string">"cycles"</span>, <span class="number">1</span>, <span class="literal">NULL</span>, <span class="string">'y'</span> &#125;,</div><div class="line">&#123; <span class="string">"send"</span>, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="string">'s'</span> &#125;,</div><div class="line">&#123; <span class="string">"receive"</span>, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="string">'r'</span> &#125;,</div><div class="line">&#123; <span class="string">"help"</span>, <span class="number">0</span>, <span class="literal">NULL</span>, <span class="string">'h'</span> &#125;,</div><div class="line">&#123; <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;</div><div class="line">&#125;;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">printHelp</span><span class="params">()</span></span>;</div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ControlArguments</span>&#123;</span></div><div class="line">    <span class="keyword">bool</span> isSend;</div><div class="line">    <span class="keyword">bool</span> isReceive;</div><div class="line">    <span class="keyword">int</span> SendCount;    <span class="comment">//packets to send at one time,only for send option,default 1</span></div><div class="line">    <span class="keyword">int</span> PacketLength;   <span class="comment">//data length in UDP packet,only for send option,default 100</span></div><div class="line">    <span class="keyword">int</span> Interval;   <span class="comment">//time between send cycles.default is 20ms,only for send option</span></div><div class="line">    <span class="keyword">int</span> Port;   <span class="comment">//port used for transmit</span></div><div class="line">    <span class="keyword">int</span> Cycles; <span class="comment">//operation cycles,only for send option,default 10</span></div><div class="line">    <span class="keyword">char</span> IP[<span class="number">15</span>];  <span class="comment">//target ip address,only for send option</span></div><div class="line">&#125;;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">sendUDP</span><span class="params">(struct ControlArguments * <span class="keyword">const</span>)</span></span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">receiveUDP</span><span class="params">(struct ControlArguments * <span class="keyword">const</span>)</span></span>;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">initControlArguments</span><span class="params">(struct ControlArguments * <span class="keyword">const</span> controlArguments)</span></span>&#123;</div><div class="line">    controlArguments-&gt;isSend = <span class="literal">false</span>;</div><div class="line">    controlArguments-&gt;isReceive = <span class="literal">false</span>;</div><div class="line">    controlArguments-&gt;SendCount = <span class="number">1</span>;</div><div class="line">    controlArguments-&gt;PacketLength = <span class="number">100</span>;</div><div class="line">    controlArguments-&gt;Interval = <span class="number">20</span>;</div><div class="line">    controlArguments-&gt;Port = <span class="number">0</span>;</div><div class="line">    controlArguments-&gt;Cycles = <span class="number">10</span>;</div><div class="line">    controlArguments-&gt;IP[<span class="number">0</span>] = <span class="string">'\0'</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">charPoint2Int</span><span class="params">(<span class="keyword">char</span> <span class="keyword">const</span> * <span class="built_in">string</span>)</span></span>&#123;</div><div class="line">    <span class="keyword">return</span> atoi(<span class="built_in">string</span>);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></div><div class="line"><span class="function"></span>&#123;</div><div class="line">    <span class="keyword">int</span> c;</div><div class="line">    <span class="keyword">int</span> index=<span class="number">0</span>;</div><div class="line">    <span class="keyword">bool</span> argumentOK = <span class="literal">true</span>;</div><div class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">struct</span> <span class="title">ControlArguments</span>  <span class="title">controlArguments</span>;</span></div><div class="line">    initControlArguments(&amp;controlArguments);</div><div class="line">    <span class="keyword">while</span>((c = getopt_long (argc, argv, short_options, long_options, &amp;index)) != <span class="number">-1</span>)</div><div class="line">    &#123;</div><div class="line">        <span class="keyword">switch</span> (c)</div><div class="line">        &#123;</div><div class="line">        <span class="keyword">case</span> <span class="string">'s'</span>:</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"Send\n"</span>);</div><div class="line">            controlArguments.isSend = <span class="literal">true</span>;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">'r'</span>:</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"Receive\n"</span>);</div><div class="line">            controlArguments.isReceive = <span class="literal">true</span>;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">'c'</span>:</div><div class="line">            l_opt_arg = optarg;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"Send Count : %s\n"</span>, l_opt_arg);</div><div class="line">            controlArguments.SendCount = charPoint2Int(l_opt_arg);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">'y'</span>:</div><div class="line">            l_opt_arg = optarg;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"Send Cycles : %s\n"</span>, l_opt_arg);</div><div class="line">            controlArguments.Cycles = charPoint2Int(l_opt_arg);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">'l'</span>:</div><div class="line">            l_opt_arg = optarg;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"Packet Length : %s\n"</span>,l_opt_arg);</div><div class="line">            controlArguments.PacketLength = charPoint2Int(l_opt_arg);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">'i'</span>:</div><div class="line">            l_opt_arg = optarg;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"Interval Time : %s\n"</span>,l_opt_arg);</div><div class="line">            controlArguments.Interval = charPoint2Int(l_opt_arg);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">'h'</span>:</div><div class="line">            printHelp();</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">'p'</span>:</div><div class="line">            l_opt_arg = optarg;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"Chosen Port : %s\n"</span>,l_opt_arg);</div><div class="line">            controlArguments.Port = charPoint2Int(l_opt_arg);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">'a'</span>:</div><div class="line">            l_opt_arg = optarg;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"Target IP : %s\n"</span>,l_opt_arg);</div><div class="line">            <span class="built_in">strncpy</span>(controlArguments.IP,l_opt_arg,<span class="number">15</span>);</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"Do not match!!!\n"</span>);</div><div class="line">            argumentOK = <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(argumentOK)&#123;</div><div class="line">        <span class="keyword">if</span>(controlArguments.isSend &amp;&amp; !controlArguments.isReceive)&#123;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"choosing send\n"</span>);</div><div class="line">            sendUDP(&amp;controlArguments);</div><div class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(controlArguments.isReceive &amp;&amp; !controlArguments.isSend)&#123;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"choosing receive\n"</span>);</div><div class="line">            receiveUDP(&amp;controlArguments);</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"**************************\n"</span>);</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"Arguments Error!    both send and receive.\n"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"************************************************\n"</span>);</div><div class="line">        printHelp();</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">printHelp</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"Help Menu:\n  Argument reference list:\n"</span>);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"    -s  :send UDP packets.\n"</span>);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"    -r  :receive UDP packets.\n"</span>);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"    -c --count  :packets to send one cycle.default is 1.\n"</span>);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"    -y --cycles  :send cycles.default is 10.\n"</span>);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"    -l --length  :data length in udp packet.default is 100bytes.\n"</span>);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"    -i --interval  :milliseconds between send options.default is 20ms.\n"</span>);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"    -a --ip  :ip address to operate.\n"</span>);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"    -p --port  :port used for UDP socket.\n"</span>);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"    -h --help  :command help.\n"</span>);</div><div class="line">&#125;</div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">Check IP Format</span></div><div class="line"><span class="comment">if format error return false;</span></div><div class="line"><span class="comment">if format check passed return true;</span></div><div class="line"><span class="comment">argument is the pointer to the IP string.</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">IPFormatCheck</span><span class="params">(<span class="keyword">char</span> * <span class="keyword">const</span> IP)</span></span>&#123;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"IP check\n"</span>);</div><div class="line">    <span class="keyword">int</span> ip_length = <span class="built_in">strlen</span>(IP);</div><div class="line">    <span class="keyword">bool</span> checkError = <span class="literal">false</span>;</div><div class="line">    <span class="keyword">int</span> count_s = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>,interval = <span class="number">0</span> ; i &lt; ip_length ; ++ i)&#123;</div><div class="line">        <span class="keyword">if</span>(IP[i] == <span class="string">'.'</span>)&#123;</div><div class="line">            <span class="keyword">if</span>(interval == <span class="number">0</span> || interval &gt; <span class="number">3</span>)&#123;</div><div class="line">                checkError = <span class="literal">true</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;<span class="keyword">else</span>&#123;</div><div class="line">                ++ count_s;</div><div class="line">                interval = <span class="number">0</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(IP[i] &gt;= <span class="string">'0'</span> &amp;&amp; IP[i] &lt;= <span class="string">'9'</span>)&#123;</div><div class="line">            ++ interval;</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            checkError = <span class="literal">true</span>;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(count_s != <span class="number">3</span>)&#123;</div><div class="line">        checkError = <span class="literal">true</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> (!checkError);</div><div class="line">&#125;</div><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment">Check Arguments for send Process</span></div><div class="line"><span class="comment">if check passed return true;</span></div><div class="line"><span class="comment">if check failed return false;</span></div><div class="line"><span class="comment">argument is the pointer to struct ControlArguments.</span></div><div class="line"><span class="comment">*/</span></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">checkSendConfig</span><span class="params">(struct ControlArguments * <span class="keyword">const</span> controlArguments)</span></span>&#123;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"checking arguments.\n"</span>);</div><div class="line">    <span class="keyword">bool</span> returnVaule;</div><div class="line">    <span class="keyword">char</span> * IP;</div><div class="line">    IP = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="built_in">strlen</span>(controlArguments-&gt;IP)) + <span class="number">1</span>);</div><div class="line">    <span class="built_in">strncpy</span>(IP,controlArguments-&gt;IP,<span class="number">15</span>);</div><div class="line">    <span class="keyword">if</span>(<span class="built_in">strlen</span>(IP) != <span class="number">0</span>)&#123;</div><div class="line">        <span class="keyword">if</span>(IPFormatCheck(IP))&#123;</div><div class="line">            <span class="keyword">if</span>((controlArguments-&gt;Port == <span class="number">0</span>) || (controlArguments-&gt;PacketLength == <span class="number">0</span>))&#123;</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"Port:%d  Length:%d\n"</span>,controlArguments-&gt;Port,controlArguments-&gt;PacketLength);</div><div class="line">                <span class="built_in">printf</span>(<span class="string">"[Error] : Port or PacketLength Error.\n"</span>);</div><div class="line">                returnVaule = <span class="literal">false</span>;</div><div class="line">            &#125;<span class="keyword">else</span>&#123;</div><div class="line">                returnVaule = <span class="literal">true</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            <span class="built_in">printf</span>(<span class="string">"[Error] : IP Error\n"</span>);</div><div class="line">            returnVaule = <span class="literal">false</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"[Error] : IP length = 0!\n"</span>);</div><div class="line">        returnVaule = <span class="literal">false</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">free</span>(IP);</div><div class="line">    <span class="keyword">return</span> returnVaule;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">threadSend</span><span class="params">(struct ControlArguments * <span class="keyword">const</span> controlArguments)</span></span>&#123;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"****************************************\nSending Thread Start\n"</span>);</div><div class="line">    <span class="comment">//定义sockfd</span></div><div class="line">    <span class="keyword">int</span> sock_cli = socket(AF_INET,SOCK_DGRAM, <span class="number">0</span>);</div><div class="line">    <span class="comment">//定义sockaddr_in</span></div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">servaddr</span>;</span></div><div class="line">    <span class="built_in">memset</span>(&amp;servaddr, <span class="number">0</span>, <span class="keyword">sizeof</span>(servaddr));</div><div class="line">    servaddr.sin_family = AF_INET;</div><div class="line">    servaddr.sin_port = htons(controlArguments-&gt;Port);  <span class="comment">//服务器端口</span></div><div class="line">    servaddr.sin_addr.s_addr = inet_addr(controlArguments-&gt;IP);  <span class="comment">//服务器ip</span></div><div class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> <span class="title">time</span>;</span></div><div class="line">    <span class="comment">//连接服务器，成功返回0，错误返回-1</span></div><div class="line">    <span class="keyword">if</span> (connect(sock_cli, (struct sockaddr *)&amp;servaddr, <span class="keyword">sizeof</span>(servaddr)) != <span class="number">0</span>)&#123;</div><div class="line">        perror(<span class="string">"connect"</span>);</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="keyword">char</span> *sendbuf = <span class="built_in">malloc</span>(controlArguments-&gt;PacketLength);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span> ; i &lt; controlArguments-&gt;PacketLength - <span class="number">1</span> ; i++)&#123;</div><div class="line">            gettimeofday(&amp;time,<span class="literal">NULL</span>);</div><div class="line">            <span class="keyword">int</span> seed = time.tv_usec + i;</div><div class="line">            sendbuf[i] = rand_r(&amp;seed) % <span class="number">93</span> + <span class="number">33</span>;</div><div class="line">        &#125;</div><div class="line">        sendbuf[controlArguments-&gt;PacketLength - <span class="number">1</span>] = <span class="string">'\0'</span>;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"buf : %s\n"</span>,sendbuf);</div><div class="line">        <span class="keyword">useconds_t</span> sleep_us = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)controlArguments-&gt;Interval * <span class="number">1000</span>;</div><div class="line">        <span class="keyword">int</span> pack_seq = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>  ; i &lt; controlArguments-&gt;Cycles ; ++ i)&#123;</div><div class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = <span class="number">0</span> ; j &lt; controlArguments-&gt;SendCount ; j++)&#123;</div><div class="line">                <span class="keyword">char</span> *realSend = <span class="built_in">malloc</span>((<span class="built_in">strlen</span>(sendbuf) + <span class="number">20</span>));</div><div class="line">                <span class="keyword">if</span>(realSend)&#123;</div><div class="line">                    gettimeofday(&amp;time,<span class="literal">NULL</span>);</div><div class="line">                    <span class="built_in">sprintf</span>(realSend,<span class="string">"[%4ld.%06ld][%4d]:%s"</span>,time.tv_sec,time.tv_usec,++pack_seq,sendbuf);</div><div class="line">                    <span class="keyword">if</span>(send(sock_cli, realSend, <span class="built_in">strlen</span>(realSend),<span class="number">0</span>) &gt; <span class="number">0</span>)&#123;</div><div class="line">                        <span class="built_in">printf</span>(<span class="string">"Send Successful\n"</span>);</div><div class="line">                    &#125;</div><div class="line">                    <span class="built_in">free</span>(realSend);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            usleep(sleep_us);</div><div class="line">        &#125;</div><div class="line">        <span class="built_in">free</span>(sendbuf);</div><div class="line"><span class="comment">//        printf("free.\n");</span></div><div class="line">    &#125;</div><div class="line">    close(sock_cli);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"Sending Thread Finish\n****************************************\n"</span>);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">sendUDP</span><span class="params">(struct ControlArguments * <span class="keyword">const</span> controlArguments)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(checkSendConfig(controlArguments))&#123;</div><div class="line"><span class="comment">//        pthread_t tid;</span></div><div class="line">        <span class="built_in">printf</span>(<span class="string">"Before Send Thread\n"</span>);</div><div class="line"><span class="comment">//        pthread_create(&amp;tid, NULL, threadSend(controlArguments), NULL);</span></div><div class="line"><span class="comment">//        pthread_tryjoin_np(tid, NULL);</span></div><div class="line">        threadSend(controlArguments);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"After Send Thread\n"</span>);</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        ;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">checkReceiveConfig</span><span class="params">(struct ControlArguments * <span class="keyword">const</span> controlArguments)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(controlArguments-&gt;Port == <span class="number">0</span>)&#123;</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"[Error] : Please set Listening port.\n"</span>);</div><div class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">threadReceive</span><span class="params">(struct ControlArguments * <span class="keyword">const</span> controlArguments)</span></span>&#123;</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"****************************************\nReceiving Thread Start\n"</span>);</div><div class="line">    <span class="comment">//定义sockfd</span></div><div class="line">    <span class="keyword">int</span> server_sockfd = socket(AF_INET,SOCK_DGRAM, <span class="number">0</span>);</div><div class="line">    <span class="keyword">static</span> <span class="keyword">int</span> recive_serial = <span class="number">0</span>;</div><div class="line">    <span class="keyword">if</span>(server_sockfd &lt; <span class="number">0</span>)&#123;</div><div class="line">        perror(<span class="string">"socket"</span>);</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        <span class="comment">//定义sockaddr_in</span></div><div class="line">        struct sockaddr_in server_sockaddr;</div><div class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">client_addr</span>;</span></div><div class="line">        <span class="built_in">memset</span>(&amp;server_sockaddr,<span class="number">0</span>,<span class="keyword">sizeof</span>(struct sockaddr_in));</div><div class="line">        server_sockaddr.sin_family = AF_INET;</div><div class="line">        server_sockaddr.sin_port = htons(controlArguments-&gt;Port);</div><div class="line">        server_sockaddr.sin_addr.s_addr = htonl(INADDR_ANY);</div><div class="line">        <span class="comment">//bind，成功返回0，出错返回-1</span></div><div class="line">        <span class="keyword">if</span>(bind(server_sockfd,(struct sockaddr *)&amp;server_sockaddr,<span class="keyword">sizeof</span>(server_sockaddr))==<span class="number">-1</span>)&#123;</div><div class="line">            perror(<span class="string">"bind"</span>);</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            <span class="comment">//客户端套接字</span></div><div class="line">            <span class="keyword">char</span> buffer[<span class="number">1024</span>];</div><div class="line">            <span class="keyword">socklen_t</span> length = <span class="keyword">sizeof</span>(client_addr);</div><div class="line">            <span class="keyword">int</span> recv_len = <span class="number">0</span>;</div><div class="line">            <span class="class"><span class="keyword">struct</span> <span class="title">timeval</span> <span class="title">time</span>;</span></div><div class="line">            <span class="keyword">while</span>(<span class="number">1</span>)&#123;</div><div class="line">                <span class="comment">//成功返回非负描述字，出错返回-1</span></div><div class="line">                recv_len = recvfrom(server_sockfd,buffer,<span class="keyword">sizeof</span>(buffer),<span class="number">0</span>,(struct sockaddr *)&amp;client_addr,&amp;length);</div><div class="line">                gettimeofday(&amp;time,<span class="literal">NULL</span>);</div><div class="line">                <span class="keyword">if</span>(recv_len &gt;= <span class="number">0</span>)&#123;</div><div class="line">                    ++ recive_serial;</div><div class="line">                    <span class="built_in">printf</span>(<span class="string">"[%8ld.%06ld]Get[%d][l:%d] : %s\n"</span>,time.tv_sec,time.tv_usec,recive_serial,recv_len,buffer);</div><div class="line">                &#125;</div><div class="line">                <span class="built_in">memset</span>(&amp;buffer,<span class="number">0</span>,<span class="keyword">sizeof</span>(buffer));</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    close(server_sockfd);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"Receiving Thread Finish\n****************************************\n"</span>);</div><div class="line">&#125;</div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">receiveUDP</span><span class="params">(struct ControlArguments * <span class="keyword">const</span> controlArguments)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(checkReceiveConfig(controlArguments))&#123;</div><div class="line"><span class="comment">//        pthread_t tid;</span></div><div class="line">        <span class="built_in">printf</span>(<span class="string">"Before Thread\n"</span>);</div><div class="line"><span class="comment">//        pthread_create(&amp;tid, NULL, threadReceive(controlArguments), NULL);</span></div><div class="line"><span class="comment">//        pthread_tryjoin_np(tid, NULL);</span></div><div class="line">        threadReceive(controlArguments);</div><div class="line">        <span class="built_in">printf</span>(<span class="string">"After Thread\n"</span>);</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        ;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="函数解析"><a href="#函数解析" class="headerlink" title="函数解析"></a>函数解析</h2><h4 id="1-main-int-argc-char-argv"><a href="#1-main-int-argc-char-argv" class="headerlink" title="1.main(int argc, char *argv[])"></a>1.main(int argc, char *argv[])</h4><pre><code>int main(int argc, char *argv[])
</code></pre><p>主函数，用于接收参数和命令行解析。采用了getopt.h中提供的参数解析功能。可以像Linux自带的命令工具一样，可以通过短参或长参进行运行时的参数设定。</p>
<p>采用的参数设定方式可以调用短参数－ｈ进行查看。默认的参数设定方式如下：</p>
<pre><code>-s  :send UDP packets.
-r  :receive UDP packets.
-c --count  :packets to send one cycle.default is 1.
-y --cycles  :send cycles.default is 10.
-l --length  :data length in udp packet.default is 100bytes.
-i --interval  :milliseconds between send options.default is 20ms.
-a --ip  :ip address to operate.
-p --port  :port used for UDP socket.
-h --help  :command help.
</code></pre><h4 id="2．IPFormatCheck-char-const-IP"><a href="#2．IPFormatCheck-char-const-IP" class="headerlink" title="2．IPFormatCheck(char * const IP)"></a>2．IPFormatCheck(char * const IP)</h4><pre><code>bool　IPFormatCheck(char * const IP)
</code></pre><p>IP格式检查函数，传入的参数是输入的IP字符串，返回的是检查结果。如果IP字符串符合IP的书写格式，返回true；如果IP字符串出现错误，返回false。</p>
<p>该检查函数仅面向IPv4，如果输入的地址是IPv6，将返回false。</p>
<h4 id="3．checkSendConfig-struct-ControlArguments-const-controlArguments"><a href="#3．checkSendConfig-struct-ControlArguments-const-controlArguments" class="headerlink" title="3．checkSendConfig(struct ControlArguments * const controlArguments)"></a>3．checkSendConfig(struct ControlArguments * const controlArguments)</h4><pre><code>bool　checkSendConfig(struct ControlArguments * const controlArguments)
</code></pre><p>发送参数检查，传入的参数是ControlArguments结构体指针，如果参数完备，返回true；如果参数出现冲突或者错误，返回false。</p>
<p>检查过程中，需要检查设定的IP地址，目标端口地址。如果任何一个参数出现错误，将返回false。</p>
<h4 id="4．checkReceiveConfig-struct-ControlArguments-const-controlArguments"><a href="#4．checkReceiveConfig-struct-ControlArguments-const-controlArguments" class="headerlink" title="4．checkReceiveConfig(struct ControlArguments * const controlArguments)"></a>4．checkReceiveConfig(struct ControlArguments * const controlArguments)</h4><pre><code>bool checkReceiveConfig(struct ControlArguments * const controlArguments)
</code></pre><p>监听参数检查，因为监听的是本地端口，所以只要本地端口号不为空即可。</p>
<p>传入的参数是ControlArguments结构体指针，返回值为true或者false。</p>
<h4 id="5．threadSend-struct-ControlArguments-const-controlArguments"><a href="#5．threadSend-struct-ControlArguments-const-controlArguments" class="headerlink" title="5．threadSend(struct ControlArguments * const controlArguments)"></a>5．threadSend(struct ControlArguments * const controlArguments)</h4><pre><code>void threadSend(struct ControlArguments * const controlArguments)
</code></pre><p>UDP数据包发送函数，可以作为单独的线程运行。传入的参数为ControlArguments结构体指针，根据设定的发送轮次和间隔、计数进行一次发送过程。</p>
<p>在UDP的数据负载设定中，采用了随机填充的方法，通过随机数到ASCII码的映射，实现定长负载的内容生成。</p>
<h4 id="6．threadReceive-struct-ControlArguments-const-controlArguments"><a href="#6．threadReceive-struct-ControlArguments-const-controlArguments" class="headerlink" title="6．threadReceive(struct ControlArguments * const controlArguments)"></a>6．threadReceive(struct ControlArguments * const controlArguments)</h4><pre><code>void threadReceive(struct ControlArguments * const controlArguments)
</code></pre><p>socket处于轮询等待的状态，不断从缓冲区中读取数据包。在接收到数据包后，根据当前的时间添加接收时间戳，用于传输的评估。</p>
<h4 id="7．sendUDP-struct-ControlArguments-const-controlArguments"><a href="#7．sendUDP-struct-ControlArguments-const-controlArguments" class="headerlink" title="7．sendUDP(struct ControlArguments * const controlArguments)"></a>7．sendUDP(struct ControlArguments * const controlArguments)</h4><pre><code>void sendUDP(struct ControlArguments * const controlArguments)
</code></pre><p>该函数用于调用threadSend函数，在具备pthread支持的环境中，可以将发送线程作为子线程处理。因为此处不具备多线程优化的意义，所以暂时将相关功能屏蔽。</p>
<h4 id="8．receiveUDP-struct-ControlArguments-const-controlArguments"><a href="#8．receiveUDP-struct-ControlArguments-const-controlArguments" class="headerlink" title="8．receiveUDP(struct ControlArguments * const controlArguments)"></a>8．receiveUDP(struct ControlArguments * const controlArguments)</h4><pre><code>void receiveUDP(struct ControlArguments * const controlArguments)
</code></pre><p>该函数用于调用threadReceive函数，代码中设计使用pthread进行子线程处理，因为此处多线程效果有限，相关功能暂时屏蔽。</p>
</div><div class="tags"><a href="/tags/c/">C</a><a href="/tags/udp/">UDP</a><a href="/tags/linux/">Linux</a></div><div class="post-share"><div class="bdsharebuttonbox"><span style="float:left;line-height: 28px;height: 28px;font-size:16px;font-weight:blod">分享到：</span><a href="#" data-cmd="more" class="bds_more"></a><a href="#" data-cmd="mshare" title="分享到一键分享" class="bds_mshare"></a><a href="#" data-cmd="fbook" title="分享到Facebook" class="bds_fbook"></a><a href="#" data-cmd="twi" title="分享到Twitter" class="bds_twi"></a><a href="#" data-cmd="linkedin" title="分享到linkedin" class="bds_linkedin"></a><a href="#" data-cmd="youdao" title="分享到有道云笔记" class="bds_youdao"></a><a href="#" data-cmd="evernotecn" title="分享到印象笔记" class="bds_evernotecn"></a><a href="#" data-cmd="weixin" title="分享到微信" class="bds_weixin"></a><a href="#" data-cmd="qzone" title="分享到QQ空间" class="bds_qzone"></a><a href="#" data-cmd="tsina" title="分享到新浪微博" class="bds_tsina"></a></div></div><div id="comments"><div id="SOHUCS" sid="2017/08/05/A-UDP-code/"></div></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#一个简单的UDP测试程序"><span class="toc-text">一个简单的UDP测试程序</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#功能介绍"><span class="toc-text">功能介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#它能干什么？"><span class="toc-text">它能干什么？</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#代码展示"><span class="toc-text">代码展示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#函数解析"><span class="toc-text">函数解析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-main-int-argc-char-argv"><span class="toc-text">1.main(int argc, char *argv[])</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2．IPFormatCheck-char-const-IP"><span class="toc-text">2．IPFormatCheck(char * const IP)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3．checkSendConfig-struct-ControlArguments-const-controlArguments"><span class="toc-text">3．checkSendConfig(struct ControlArguments * const controlArguments)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4．checkReceiveConfig-struct-ControlArguments-const-controlArguments"><span class="toc-text">4．checkReceiveConfig(struct ControlArguments * const controlArguments)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5．threadSend-struct-ControlArguments-const-controlArguments"><span class="toc-text">5．threadSend(struct ControlArguments * const controlArguments)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6．threadReceive-struct-ControlArguments-const-controlArguments"><span class="toc-text">6．threadReceive(struct ControlArguments * const controlArguments)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7．sendUDP-struct-ControlArguments-const-controlArguments"><span class="toc-text">7．sendUDP(struct ControlArguments * const controlArguments)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8．receiveUDP-struct-ControlArguments-const-controlArguments"><span class="toc-text">8．receiveUDP(struct ControlArguments * const controlArguments)</span></a></li></ol></li></ol></li></ol></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2017/08/05/A-UDP-code/">一个简单的UDP测试程序</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/blog/">Blog</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/c/" style="font-size: 15px;">C</a> <a href="/tags/udp/" style="font-size: 15px;">UDP</a> <a href="/tags/linux/" style="font-size: 15px;">Linux</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="http://www.07111301.com" title="永远的07111301" target="_blank">永远的07111301</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">Baidu Site Haritası</a> |  <a href="/atom.xml">订阅</a> |  <a href="/about/">关于</a></p><p>本站总访问量：<i id="busuanzi_container_site_pv"><i id="busuanzi_value_site_pv"></i></i>次</p><p><span> Copyright &copy;<a href="/." rel="nofollow">XintingXu.</a></span><span> Count by<a href="http://busuanzi.ibruce.info/"> busuanzi.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.json.js?v=2.0.1"></script><script type="text/javascript" src="/js/toctotop.js?v=2.0.1" async></script><script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","weixin","tsina","qzone","linkedin","fbook","twi","print","renren","sqq","evernotecn","bdysc","tqq","tqf","bdxc","kaixin001","tieba","douban","bdhome","thx","ibaidu","meilishuo","mogujie","diandian","huaban","duitang","hx","fx","youdao","sdo","qingbiji","people","xinhua","mail","isohu","yaolan","wealink","ty","iguba","h163","copy"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":{},"image":{"viewList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"]}};with(document)0[(getElementsByTagName('head')[0]||head).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script><script>window._config = { showScore: true };
(function(){ 
  var appid = 'cyt9naPyg'; 
  var conf = '5b7c5e41a672a66b3791636943dbfef0'; 
  var width = window.innerWidth || document.documentElement.clientWidth; 
  var nodes =document.getElementsByTagName("head")[0]||document.head||document.documentElement;
  if (/(Android|iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent) && width < 750) {  
      window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>');
  }
  else { 
    var loadJs=function(d,a){
      var b=document.createElement("script");b.setAttribute("type","text/javascript");
      b.setAttribute("charset","UTF-8");
      b.setAttribute("src",d);
      if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}
      nodes.appendChild(b)
    };
    loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); 
  } 
  var loadCss = function(cssString){  
    var style=document.createElement("style");  
    style.setAttribute("type", "text/css");  
    if(style.styleSheet){// IE  
        style.styleSheet.cssText = cssString;  
    } else {// w3c  
        var cssText = document.createTextNode(cssString);  
        style.appendChild(cssText);  
    }
    nodes.appendChild(style);
  }
  window.onload=function(){loadCss('.module-hot-topic,.module-cmt-float-bar{display:none!important}#SOHUCS #SOHU_MAIN .module-cmt-box .post-wrap-w .wrap-action-w .cbox-prompt-w span.prompt-empty-w,#SOHUCS #SOHU_MAIN .module-cmt-float-bar .wrap-cont-w .cont-form-w .form-text-w span.text-null,#SOHUCS #SOHU_MAIN .module-cmt-float-bar .wrap-cont-w .cont-minwidth-w div.cont-comment-w a.comment-link-w,#SOHUCS #SOHU_MAIN .module-cmt-float-bar .wrap-cont-w .cont-minwidth-w div.cont-comment-w span.comment-text-w,#SOHUCS #SOHU_MAIN .module-cmt-footer .section-service-w div.service-wrap-w a:hover,#SOHUCS #SOHU_MAIN .module-cmt-header .section-cbox-w .block-head-w div.header-login,#SOHUCS #SOHU_MAIN .module-cmt-header .section-title-w .title-user-w .user-wrap-w span.wrap-name-w,#SOHUCS #SOHU_MAIN .module-cmt-list .action-click-gw span.click-disable-eg a em.icon-name-bg,#SOHUCS #SOHU_MAIN .module-cmt-list .block-title-gw ul li div.title-name-gw,#SOHUCS #SOHU_MAIN .module-cmt-list .cmt-list-type .cmt-list-number .comment-number span.cy-number,#SOHUCS #SOHU_MAIN .module-cmt-list .cmt-list-type .cmt-list-number span.comment-number,#SOHUCS #SOHU_MAIN .module-cmt-list .cmt-list-type .type-lists li.active,#SOHUCS #SOHU_MAIN .module-cmt-list .msg-wrap-gw .wrap-action-gw .action-click-gw span a:hover,#SOHUCS #SOHU_MAIN .module-cmt-list .picture-box-gw div.box-action-gw a:hover,#SOHUCS #SOHU_MAIN .module-cmt-list .wrap-action-gw .action-click-gw span a:hover em.icon-name-bg,#SOHUCS #SOHU_MAIN .module-cmt-list .wrap-user-gw span.user-name-gw a{color:#40759b!important}#SOHUCS #SOHU_MAIN .module-cmt-box .post-wrap-w .post-wrap-border-t div.post-wrap-border-t-r,#SOHUCS #SOHU_MAIN .module-cmt-box .post-wrap-w div.post-wrap-border-l,#SOHUCS #SOHU_MAIN .module-cmt-box .post-wrap-w div.post-wrap-border-r{display:none!important}#SOHUCS #SOHU_MAIN .module-cmt-box .post-wrap-w .post-wrap-border-t div.post-wrap-border-t-l{background:#FFF!important;top:-2px!important}#SOHUCS #SOHU_MAIN .module-cmt-box .post-wrap-w .wrap-action-w .action-function-w .uploading-wrapper-dw div.wrapper-image-dw,#SOHUCS #SOHU_MAIN .module-cmt-box .post-wrap-w div.post-wrap-main,#SOHUCS #SOHU_MAIN .module-cmt-float-bar .wrap-cont-w .cont-form-w div.form-text-w,#SOHUCS #SOHU_MAIN .module-cmt-header .section-cbox-w .block-head-w div.header-login,#SOHUCS #SOHU_MAIN .module-cmt-list .module-cmt-box .post-wrap-w div.post-wrap-main{border:1px solid #e6e6e6!important;border-radius:20px 20px 20px 20px;margin:0!important}#SOHUCS #SOHU_MAIN .module-cmt-box .post-wrap-w .wrap-action-w .action-issue-w .issue-btn-w a .btn-fw{width:130px!important;height:34px!important;line-height:33px!important;font-size:17px!important;background:#5483b1!important;border-radius:20px!important;color:#FFF!important;-webkit-box-shadow:0 -1px 4px #5483b1 inset;box-shadow:0 -1px 10px #5483b1 inset}#SOHUCS #SOHU_MAIN .module-cmt-box .post-wrap-w .wrap-action-w .action-issue-w .issue-btn-w a .btn-fw:before{content:"发表评论"}#SOHUCS #SOHU_MAIN .module-cmt-box .post-wrap-w .wrap-action-w .action-issue-w .issue-btn-w a:hover .btn-fw{color:#40759b!important;background:#FFF!important}#SOHUCS #SOHU_MAIN .module-cmt-list .cmt-list-type .type-lists li{background:none!important;border-bottom:1px solid #e6e6e6}#SOHUCS #SOHU_MAIN .module-cmt-list .cmt-list-type .type-lists li.active{border:1px solid #e6e6e6;border-radius:10px 10px 0 0;border-bottom:none}#SOHUCS #SOHU_MAIN .module-cmt-list .block-title-gw ul li .title-name-gw div.title-name-gw-tag{background:#5483b1!important;border-radius:3px}#SOHUCS #SOHU_MAIN .module-cmt-list .cmt-list-type div.cmt-list-border{background-color:#e6e6e6!important}#SOHUCS #SOHU_MAIN .module-cmt-notice ul.nt-list li.nt-item{border:1px solid #e6e6e6!important}#SOHUCS #SOHU_MAIN .module-cmt-notice ul.nt-list li.nt-item .nt-logo{text-align:center;line-height:40px;border-radius:50%!important;background:#e6e6e6!important}#SOHUCS #SOHU_MAIN .module-cmt-notice ul.nt-list li.nt-item .nt-logo:before{content:"畅";font-size:22px;color:#FFF}#SOHUCS #SOHU_MAIN .module-cmt-notice ul.nt-list li.nt-item a.nt-text,#SOHUCS #SOHU_MAIN .module-cmt-notice ul.nt-list li.nt-item a.nt-text i{color:#5483b1!important}#SOHUCS #SOHU_MAIN .module-cmt-header .section-title-w .title-user-w .user-wrap-w{background:#FFF!important}');};
})();</script><script src="https://assets.changyan.sohu.com/upload/plugins/plugins.count.js"></script></body></html>